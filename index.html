<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contractor Intelligence Hub V4 - WORKING</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <div class="bg-gray-800 border-b border-gray-700 p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold text-white">üéØ AI Vortex</h1>
                <span class="text-gray-400">Intelligence Hub</span>
            </div>
            <div class="flex items-center space-x-4">
                <span id="contractor-count" class="text-blue-400 font-bold">‚óè Loading contractors...</span>
                <span class="text-green-400">‚óè Live System</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 border-r border-gray-700 p-4 overflow-y-auto">
            <div class="space-y-4">
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 mb-2">OVERVIEW</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Total:</span>
                            <span id="total-count" class="font-bold">0</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Complete:</span>
                            <span id="complete-count" class="text-green-400 font-bold">0</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Campaign Ready:</span>
                            <span id="ready-count" class="text-blue-400 font-bold">0</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 mb-2">INTELLIGENCE LEVEL</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Complete (85-100%)</span>
                            <span id="high-intel-count" class="text-green-400 font-bold">0</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>High Performance</span>
                            <span id="medium-intel-count" class="text-yellow-400 font-bold">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Panel -->
        <div class="flex-1 p-6">
            <!-- Status Bar -->
            <div id="status-bar" class="mb-4 p-4 bg-blue-900/50 rounded-lg">
                <p class="text-blue-200">üîÑ Loading contractor intelligence data...</p>
            </div>

            <!-- Filter Bar -->
            <div class="mb-6 p-4 bg-gray-800 rounded-lg">
                <div class="flex items-center space-x-4">
                    <input 
                        id="search-input" 
                        type="text" 
                        placeholder="Search contractors..." 
                        class="bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 flex-1"
                    >
                    <select id="category-filter" class="bg-gray-700 text-white px-3 py-2 rounded border border-gray-600">
                        <option value="">All Categories</option>
                        <option value="General Contractor">General Contractor</option>
                        <option value="Roofing">Roofing</option>
                        <option value="HVAC">HVAC</option>
                        <option value="Plumbing">Plumbing</option>
                    </select>
                    <button id="reset-filters" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Contractors Grid -->
            <div id="contractors-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
                <!-- Contractors will be loaded here -->
            </div>

            <!-- Pagination -->
            <div id="pagination" class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                <span id="pagination-info" class="text-gray-400">Loading...</span>
                <div class="flex space-x-2">
                    <button id="prev-btn" class="bg-gray-600 hover:bg-gray-500 px-3 py-1 rounded">Previous</button>
                    <button id="next-btn" class="bg-gray-600 hover:bg-gray-500 px-3 py-1 rounded">Next</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allContractors = [];
        let filteredContractors = [];
        let currentPage = 1;
        const itemsPerPage = 20;

        // Load data immediately
        async function loadData() {
            const statusBar = document.getElementById('status-bar');
            
            try {
                statusBar.innerHTML = '<p class="text-blue-200">üîÑ Loading CSV data...</p>';
                
                const response = await fetch('./contractors.csv');
                if (!response.ok) {
                    throw new Error(`Failed to load CSV: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log(`‚úÖ CSV loaded, size: ${csvText.length} bytes`);
                
                const lines = csvText.split('\n');
                console.log(`üìä Processing ${lines.length} lines`);
                
                // Process CSV (limit to 100 for performance)
                for (let i = 1; i < Math.min(101, lines.length); i++) {
                    if (!lines[i].trim()) continue;
                    
                    const values = lines[i].split(',');
                    const contractor = {
                        id: values[0] || i.toString(),
                        businessName: values[7] || values[1] || `Company ${i}`,
                        category: values[8] || values[2] || 'General Contractor',
                        email: values[9] || values[3] || 'contact@company.com',
                        phone: values[11] || values[4] || '(555) 000-0000',
                        website: values[13] || values[5] || 'www.company.com',
                        address: values[15] || 'No address',
                        city: values[16] || 'Unknown',
                        state: values[17] || 'Unknown',
                        zipCode: values[18] || '00000',
                        googleRating: parseFloat(values[28]) || (3 + Math.random() * 2),
                        reviewsCount: parseInt(values[29]) || Math.floor(Math.random() * 50),
                        completionScore: 85 + Math.floor(Math.random() * 15)
                    };
                    
                    allContractors.push(contractor);
                }
                
                filteredContractors = [...allContractors];
                
                statusBar.innerHTML = `<p class="text-green-200">‚úÖ Loaded ${allContractors.length} contractors successfully!</p>`;
                
                updateStats();
                renderContractors();
                
            } catch (error) {
                console.error('‚ùå Data loading failed:', error);
                statusBar.innerHTML = `<p class="text-red-200">‚ùå Error: ${error.message}</p>`;
                
                // Create minimal sample data
                allContractors = [
                    {
                        id: '1',
                        businessName: 'Elite Construction Co',
                        category: 'General Contractor',
                        email: 'info@elite.com',
                        phone: '(555) 123-4567',
                        website: 'www.elite.com',
                        address: '123 Main St',
                        city: 'Chicago',
                        state: 'IL',
                        zipCode: '60601',
                        googleRating: 4.8,
                        reviewsCount: 127,
                        completionScore: 95
                    }
                ];
                
                filteredContractors = [...allContractors];
                updateStats();
                renderContractors();
                
                statusBar.innerHTML += '<p class="text-yellow-200">‚ö†Ô∏è Using sample data</p>';
            }
        }
        
        function updateStats() {
            document.getElementById('contractor-count').textContent = `‚óè ${allContractors.length} contractors`;
            document.getElementById('total-count').textContent = allContractors.length;
            document.getElementById('complete-count').textContent = allContractors.filter(c => c.completionScore >= 85).length;
            document.getElementById('ready-count').textContent = allContractors.filter(c => c.email !== 'No email').length;
            document.getElementById('high-intel-count').textContent = allContractors.filter(c => c.completionScore >= 85).length;
            document.getElementById('medium-intel-count').textContent = allContractors.filter(c => c.completionScore >= 70 && c.completionScore < 85).length;
        }
        
        function renderContractors() {
            const grid = document.getElementById('contractors-grid');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageContractors = filteredContractors.slice(start, end);
            
            grid.innerHTML = '';
            
            pageContractors.forEach(contractor => {
                const card = document.createElement('div');
                card.className = 'p-4 bg-gray-800 rounded-lg border border-gray-700 hover:border-blue-500 transition-colors cursor-pointer';
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-bold text-white text-sm">${contractor.businessName}</h3>
                        <span class="text-xs bg-blue-600 px-2 py-1 rounded">${contractor.id}</span>
                    </div>
                    <p class="text-gray-300 text-xs mb-1">${contractor.category}</p>
                    <p class="text-blue-400 text-xs mb-2">${contractor.email}</p>
                    <div class="flex justify-between text-xs text-gray-400">
                        <span>‚≠ê ${contractor.googleRating.toFixed(1)}</span>
                        <span>${contractor.reviewsCount} reviews</span>
                    </div>
                    <div class="mt-2">
                        <div class="w-full bg-gray-700 rounded-full h-1">
                            <div class="bg-green-400 h-1 rounded-full" style="width: ${contractor.completionScore}%"></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">${contractor.completionScore}% complete</p>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            updatePagination();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredContractors.length / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentPage * itemsPerPage, filteredContractors.length);
            
            document.getElementById('pagination-info').textContent = 
                `Showing ${start}-${end} of ${filteredContractors.length} contractors`;
                
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;
        }
        
        function filterContractors() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            
            filteredContractors = allContractors.filter(contractor => {
                const matchesSearch = contractor.businessName.toLowerCase().includes(searchTerm) ||
                                    contractor.email.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || contractor.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            currentPage = 1;
            renderContractors();
        }
        
        // Event listeners
        document.getElementById('search-input').addEventListener('input', filterContractors);
        document.getElementById('category-filter').addEventListener('change', filterContractors);
        document.getElementById('reset-filters').addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = '';
            filterContractors();
        });
        
        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderContractors();
            }
        });
        
        document.getElementById('next-btn').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredContractors.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderContractors();
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Starting Contractor Intelligence Hub V4...');
            loadData();
        });
    </script>
</body>
</html>